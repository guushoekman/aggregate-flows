  <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aggregate Flows</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-VhBcF/php0Z/P5ZxlxaEx1GwqTQVIBu4G4giRWxTKOCjTxsPFETUDdVL5B6vYvOt" crossorigin="anonymous">
  <style>
    svg {
      width: 100%;
      height: auto;
    }

    #popup {
      position: absolute;
      display: none;
      z-index: 100000;
      pointer-events: none;
      font-size: 12px;
    }

    #col-svg {
      transition: width .3s;
    }

    #col-svg.minimized .svg-wrapper {
      cursor: pointer;
    }

    #col-svg.minimized svg {
      pointer-events: none;
    }

    .flow {
      cursor: help;
    }

    .auntnode,
    .subnode,
    .node {
      cursor: pointer;
    }

    .flow.opaque {
      opacity: .1;
    }

    .flow.hover {
      opacity: .5;
    }

    .popover-header,
    .popover-body {
      padding: 6px 12px;
    }

    .node.active {
      stroke: #000;
    }

    text {
      pointer-events: none;
      font-family: 'Liberation Sans', sans-serif;
      font-size: 12px;
    }

    table.table {
      margin-bottom: 0;
    }

    .select-material {
      width: 100%;
    }

    .cover {
      position: absolute;
      left: 0;
      top: 0;
      width: 0;
      height: 0;
      pointer-events: none;
    }

    #col-svg.minimized .cover {
      pointer-events: unset;
      width: 100%;
      height: 100%;
      background-color: transparent;
    }

    .back-sankey {
      position: absolute;
      top: 0;
      left: 0;
      line-height: 1.5rem;
      background-color: #efefef;
      cursor: pointer;
      padding: .25rem .5rem;
      font-size: 12px;
    }

    .back-sankey i {
      margin-right: .25rem;
    }

    .x-button {
      position: absolute;
      top: 0;
      right: 0;
      height: 1.5rem;
      width: 1.5rem;
      line-height: 1.5rem;
      background-color: #efefef;
      cursor: pointer;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-light">
    <div class="container">
      <a class="navbar-brand" href="#">Aggregate flows</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded=false aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>

  <div id="popup" class="p-1 border rounded bg-white">
    <div>
      <span id="popup-from"></span>
      <span><i class="fal fa-arrow-right mx-1"></i></span>
      <span id="popup-to"></span>
    </div>
    <div>
      <span id="popup-value"></span>kt of
      <span id="popup-material"></span>
    </div>
  </div>
  <div class="container pt-4">
<!--
    <h2>Highlight by material</h2>
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="select-material btn btn-outline-primary" data-material="Sand and gravel">
          <i class="fal fa-fw me-1 fa-umbrella-beach"></i> Sand and gravel
        </div>
      </div>
      <div class="col-md-3">
        <div class="select-material btn btn-outline-danger" data-material="Rock">
          <i class="fal fa-fw me-1 fa-mountain"></i> Rock
        </div>
      </div>
    </div>
 -->
    <div class="row">
      <div id="col-svg" class="col-12">
        <div class="svg-wrapper position-relative p-3">
          <div class="close-sankey cover"></div>
          <svg data-name="global" class="global-view" width="2000" height="500" viewBox="0 0 505.88 132.03" xmlns="http://www.w3.org/2000/svg">
            <text x="196" y="5" font-size="6">Export</text>
            <text x="302" y="5" font-size="6">Import</text>
            <text x="390" y="5" font-size="6">Import</text>

            <!-- reserves to extraction -->
            <rect class="flow" data-index="0" x="40.217" y="42.598" width="52.917" height="24.342"/>
            <rect class="flow" data-index="1" x="40.217" y="66.94" width="52.917" height="11.642"/>
            <rect class="flow" data-index="2" x="40.217" y="78.581" width="52.917" height="4.2333"/>

            <!-- extraction to processing -->
            <rect class="flow" data-index="3" x="133.35" y="47.625" width="52.917" height="8.7312"/>
            <rect class="flow" data-index="4" x="133.35" y="56.356" width="52.917" height="21.431"/>

            <!-- extraction to waste -->
            <path class="flow" data-index="5" d="m109.01 82.814v49.213h379.68v-49.213h-2.9103v46.302h-373.86v-46.302z"/>

            <!-- extraction to use -->
            <path class="flow" data-index="6" d="m114.56 82.815v43.127h288.66v-43.127h-2.9104v40.217h-282.84v-40.217z"/>

            <!-- processing to manufacturing -->
            <rect class="flow" data-index="7" x="226.48" y="52.387" width="52.917" height="3.175"/>
            <rect class="flow" data-index="8" x="226.48" y="55.562" width="52.917" height="3.175"/>
            <rect class="flow" data-index="9" x="226.48" y="58.737" width="52.917" height="5.0271"/>
            <rect class="flow" data-index="10" x="226.48" y="63.765" width="52.917" height=".79375"/>
            <rect class="flow" data-index="11" x="226.48" y="64.558" width="52.917" height=".79375"/>
            <rect class="flow" data-index="12" x="226.48" y="65.352" width="52.917" height="1.3229"/>
            <rect class="flow" data-index="13" x="226.48" y="66.675" width="52.917" height="1.8521"/>

            <!-- processing to export -->
            <rect class="flow" data-index="14" x="191.56" width="1.5875" height="42.598"/>

            <!-- processing to waste -->
            <path class="flow" data-index="15" d="m192.62 82.815v37.835h290.51v-37.835h-3.175v34.66h-284.16v-34.66z"/>

            <!-- processing to use -->
            <path class="flow" data-index="16" d="m200.55 82.815v31.485h193.67v-31.485h-2.6458v28.84h-188.38v-28.84z"/>
            <path class="flow" data-index="17" d="m203.2 82.815v28.84h188.39v-7.6729h-6e-3v-21.167h-7.6729v21.167h-173.04v-21.167z"/>

            <!-- waste to processing -->
            <path class="flow" data-index="18" d="m205.58 24.077v18.521h10.848v-7.6729h275.17v7.6729h10.848v-18.521h-10.848z"/>
            <path class="flow" data-index="19" d="m216.43 34.925v7.6729h1.5875v-6.0854h271.99v6.0854h1.5875v-7.6729h-273.58z"/>

            <!-- manufacturing to use -->
            <rect class="flow" data-index="20" x="319.62" y="60.854" width="52.917" height="1.0583"/>
            <rect class="flow" data-index="21" x="319.62" y="61.912" width="52.917" height="4.2333"/>

            <!-- manufacturing to waste -->
            <path class="flow" data-index="22" d="m297.92 82.815v14.817h179.92v-14.817h-2.9104v11.906h-174.1v-11.906z"/>

            <!-- import to manufacturing -->
            <rect class="flow" data-index="23" x="297.92" width="2.1167" height="42.598"/>

            <!-- import to use -->
            <rect class="flow" data-index="24" x="385.43" width="2.3812" height="44.319"/>

            <!-- use to waste -->
            <rect class="flow" data-index="25" x="412.75" y="59.531" width="52.917" height="7.4083"/>

            <!-- waste to use -->
            <path class="flow" data-index="26" d="m393.7 37.306v5.2917h1.3229v-3.9688h90.488v3.9688h1.3229v-5.2917h-91.81z"/>

            <!-- nodes -->
            <rect class="node open-node" data-name="Reserves" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="6.8749571" y="65.075249"><tspan x="6.8749571" y="65.075249" style="fill:#000000;font-family:FreeSans;font-size:6.35px;">Reserves</tspan></text>

            <rect class="node open-node" data-name="Extraction" x="93.133" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="99.389206" y="65.075249"><tspan x="99.389206" y="65.075249" style="fill:#000000;font-family:FreeSans;font-size:6.35px;">Extraction</tspan></text>

            <rect class="node open-node" data-name="Processing / production" x="186.27" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="206.89563" y="60.359631"><tspan x="206.89563" y="60.359631" style="fill:#000000;font-family:FreeSans;font-size:6.35px;text-align:center;text-anchor:middle">Processing / </tspan><tspan x="206.89563" y="68.55262" style="fill:#000000;font-family:FreeSans;font-size:6.35px;text-align:center;text-anchor:middle">production</tspan></text>

            <rect class="node open-node" data-name="Manufacturing" x="279.4" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="299.45193" y="64.284325"><tspan x="299.45193" y="64.284325" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Manufacturing</tspan></text>

            <rect class="node open-node" data-name="Use" x="372.53" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="392.58527" y="64.284325"><tspan x="392.58527" y="64.284325" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Use</tspan></text>

            <rect class="node open-node" data-name="Waste management" x="465.67" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="485.66217" y="60.634529"><tspan x="485.66217" y="60.634529" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Waste</tspan><tspan x="485.66217" y="67.917183" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">management</tspan></text>
          </svg>
        </div>
      </div>
    </div>

    <div class="sankey-wrapper position-relative border p-4 my-4" hidden>
      <div class="close-sankey border-start border-bottom x-button"><i class="fal fa-times"></i></div>

      <div id="nodesankey-wrapper">
        <div class="nodesankey" data-name="Reserves" hidden>Reserves</div>
        <div class="nodesankey" data-name="Extraction" hidden>
          <h4 class="text-center">Extraction</h4>

          <svg data-name="Extraction" viewBox="0 0 1169 422.92" xmlns="http://www.w3.org/2000/svg">
            <path class="flow" data-index="0" d="m530.8 34.041c-112.5 0-112.5 11.186-225 11.186s-142.5-4.584-255-4.584v223.19c105.22 0 139.12 3.9636 235 4.4824v0.10156h20c112.5 0 112.5-11.186 225-11.186l10-111.59z" style="fill:#ae9e80"/>
            <path class="flow" data-index="1" d="m530.8 257.23c-112.5 0-112.5 19.184-225 19.184h-20c-112.5 0-122.5-12.584-235-12.584v63.957c112.26 0 123.17 10.652 235 10.697 0.011 1e-5 0.0203 0 0.0312 0 0.22632 9e-5 0.41738 4e-3 0.64453 4e-3v-4e-3h19.324c111.85-0.0391 118.31-19.187 229.77-19.297l5.2324-21.283z" style="fill:#dec580"/>
            <path class="flow" data-index="2" d="m50.801 327.79v42.666c112.49 0 122.53 37.981 235 37.988v2e-3h40c105.13 0 116.51-24.243 209.35-27.42l5.6504-15.326-10-27.121c-112.5 0-112.5 27.186-225 27.186v-2e-3h-20c-112.5 0-122.5-37.973-235-37.973z" style="fill:#f2f78a"/>
            <path class="flow" data-index="3" d="m535.57 319.19c-111.46 0.11014-117.92 19.258-229.77 19.297h-20v0.0117c-111.85 0.16392-122.73 39.957-235 39.957v17.391c112.5 0 122.5-38.084 235-38.084h20v2e-3c112.5 0 112.5-19.186 225-19.186z" style="fill:#dec580"/>
            <path class="flow" data-index="4" d="m535.15 381.02c-111.87 0.10719-117.99 25.893-230.26 27.492l-19.055-0.0742-0.0332 11.561 20.148 0.29492c112.49 1.65 112.22-27.133 224.72-27.133zm-249.35 38.979v-5.7871l0.0332-5.7734c-112.5 0-122.53-12.598-235.03-12.598v11.574c112.5 0 122.5 12.584 235 12.584z" style="fill:#f2f78a"/>
            <path class="flow" data-index="5" d="m825.8 2e-3c-112.5 0-122.5 34.039-235 34.039v202.84c112.5 0 122.5-34.039 235-34.039h20c112.5 0 112.5 3.6445 225 3.6445l10-101.42-10-101.42c-112.5 0-112.5-3.6465-225-3.6465z" style="fill:#ae9e80"/>
            <path class="flow" data-index="6" d="m1070.8 206.49c-112.5 0-112.5 4.3555-225 4.3555h-20c-112.5 0-122.5 26.039-235 26.039v58.127c112.5 0 122.5-26.041 235-26.041h20c112.5 0 112.5-4.3535 225-4.3535l10-29.064z" style="fill:#dec580"/>
            <path class="flow" data-index="7" d="m1070.8 264.61c-112.5 0-112.5 12.354-225 12.354h-20c-112.5 0-122.5 18.041-235 18.041v39.367c112.5 0 122.5-18.039 235-18.039h20c112.5 0 112.5-12.355 225-12.355l10-19.684z" style="fill:#f2f78a"/>
            <path class="flow" data-index="8" d="m825.8 324.34c-112.5 0-122.5 10.039-235 10.039v23.664c112.5 0 122.5-10.039 235-10.039h20c112.5 0 112.5 2.9062 225 2.9062l10-11.834-10-11.832c-112.5 0-112.5-2.9043-225-2.9043z" style="fill:#ae9e80"/>
            <path class="flow" data-index="9" d="m1070.8 350.91c-112.5 0-112.5 5.0938-225 5.0938h-20c-112.5 0-122.5 2.0391-235 2.0391v4.9375c112.5 0 122.5-2.041 235-2.041h20c112.5 0 112.5-5.0938 225-5.0938l10-2.4688z" style="fill:#dec580"/>
            <path class="flow" data-index="10" d="m1070.8 355.84c-112.5 0-112.5 13.094-225 13.094h-20c-112.5 0-122.5-5.959-235-5.959v3.3301c112.5 0 122.5 5.959 235 5.959h20c112.5 0 112.5-13.094 225-13.094l10-1.666z" style="fill:#f2f78a"/>
            <path class="flow" data-index="11" d="m590.8 366.31v16.002c112.5 0 122.5 13.961 235 13.961h20c112.5 0 112.5 3.5469 225 3.5469l10-8.002-10-8c-112.5 0-112.5-3.5488-225-3.5488h-20c-112.5 0-122.5-13.959-235-13.959z" style="fill:#ae9e80"/>
            <path class="flow" data-index="12" d="m590.8 382.31v4.9375c112.5 0 122.5 21.959 235 21.959h20c112.5 0 112.5-4.4512 225-4.4512l10-2.4688-10-2.4688c-112.5 0-112.5 4.4531-225 4.4531h-20c-112.5 0-122.5-21.961-235-21.961z" style="fill:#dec580"/>
            <path class="flow" data-index="13" d="m590.8 387.25v2.793c112.5 0 122.5 29.961 235 29.961h20c112.5 0 112.5-12.453 225-12.453l10-1.3965-10-1.3965c-112.5 0-112.5 12.451-225 12.451h-20c-112.5 0-122.5-29.959-235-29.959z" style="fill:#f2f78a"/>

            <rect class="node" data-name="Terrestrial" x=".80176" y="40.37" width="50" height="329.81" style="fill:#c48d98"/>
            <text class="node-label" x="-0.26953125" y="209.74858">Terrestrial</text>

            <rect class="node" data-name="Marine" x=".80176" y="378.45" width="50" height="28.964" style="fill:#c5e9df"/>
            <text class="node-label" x="7.2363272" y="397.40765">Marine</text>

            <text class="node-label" x="281.90302" y="395.22574">Sand</text>
            <text class="node-label" x="278.23004" y="320.74017">Gravel</text>
            <text class="node-label" x="257.47217" y="155.70261">Crushed Rock</text>

            <rect class="node" data-name="Extraction" x="540.8" y="33.766" width="50" height="358.78" style="fill:#a7e66f"/>
            <text class="node-label" x="539.02094" y="217.62968">Extraction</text>

            <text class="node-label" x="823.82397" y="300.85342">Sand</text>
            <text class="node-label" x="819.28552" y="245.22638">Gravel</text>
            <text class="node-label" x="797.33405" y="105.62245">Crushed Rock</text>
            <text class="node-label" x="823.81482" y="374.80301">Sand</text>
            <text class="node-label" x="819.28552" y="362.66995">Gravel</text>
            <text class="node-label" x="797.33405" y="340.37012">Crushed Rock</text>
            <text class="node-label" x="823.69849" y="421.01978">Sand</text>
            <text class="node-label" x="819.78296" y="408.74667">Gravel</text>
            <text class="node-label" x="797.54596" y="391.91196">Crushed Rock</text>

            <rect class="node" data-name="Processing/Production" x="1080.8" y="3.648" width="50" height="300.34" style="fill:#a7e66f"/>
            <text class="node-label" x="1138.2937" y="149.62854" text-anchor="end"><tspan x="1138.2937" y="149.62854">Processing /</tspan><tspan x="1138.2937" y="164.62854">production</tspan></text>

            <rect class="node" data-name="Use as Fill" x="1080.8" y="326.97" width="50" height="31.93" style="fill:#ca91fd"/>
            <text class="node-label" x="1133.7146" y="347.40802" text-anchor="end">Use as Fill</text>

            <rect class="node" data-name="Waste Processing" x="1080.8" y="383.81" width="50" height="23.734" style="fill:#d980b7"/>
            <text class="node-label" x="1154.2605" y="399.88309" text-anchor="end">Waste Processing</text>
          </svg>

        </div>
        <div class="nodesankey" data-name="Processing / production" hidden>Processing / production</div>
        <div class="nodesankey" data-name="Manufacturing" hidden>Manufacturing</div>

        <div class="nodesankey" data-name="Use" hidden>
          <h4 class="text-center">Use</h4>
          <svg data-name="Use" viewBox="0 0 1025 340" xmlns="http://www.w3.org/2000/svg">
           <path class="flow" data-index="0" d="m90 126.01c189 0 189 15 378 15v37.5c-189 0-189-15-378-15z" style="fill:#ffd700"/>
           <path class="flow" data-index="1" d="m90 163.51c189 0 189 15 378 15v18.75c-189 0-189-15-378-15z" style="fill:#f00"/>
           <path class="flow" data-index="2" d="m90 182.26c189 0 189 15 378 15v18.75c-189 0-189-15-378-15z" style="fill:#a52a2a"/>
           <path class="flow" data-index="3" d="m90 51.005h378v37.5h-378z" style="fill:#ffd700"/>
           <path class="flow" data-index="4" d="m90 88.505h378v18.75h-378z" style="fill:#f00"/>
           <path class="flow" data-index="5" d="m90 107.26h378v18.75h-378z" style="fill:#a52a2a"/>
           <path class="flow" data-index="6" d="m90 283.51c189 0 189-67.5 378-67.5v18.75c-189 0-189 67.5-378 67.5z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="7" d="m90 302.26h378v18.75h-378z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="8" d="m90 222.01c189 0 189 27.75 378 27.75v18.75c-189 0-189-27.75-378-27.75z" style="fill:#a52a2a"/>
           <path class="flow" data-index="9" d="m558 141.01c188.5 0 188.5-31.75 377-31.75v18.75c-188.5 0-188.5 31.75-377 31.75z" style="fill:#ffd700"/>
           <path class="flow" data-index="10" d="m558 159.76c188.5 0 188.5-31.75 377-31.75v18.75c-188.5 0-188.5 31.75-377 31.75z" style="fill:#f00"/>
           <path class="flow" data-index="11" d="m558 178.51c188.5 0 188.5-31.75 377-31.75v18.75c-188.5 0-188.5 31.75-377 31.75z" style="fill:#a52a2a"/>
           <path class="flow" data-index="12" d="m558 197.26c188.5 0 188.5-31.75 377-31.75v18.75c-188.5 0-188.5 31.75-377 31.75z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="13" d="m558 51.005c188.5 0 188.5 2 377 2v18.75c-188.5 0-188.5-2-377-2z" style="fill:#ffd700"/>
           <path class="flow" data-index="14" d="m558 69.755c188.5 0 188.5 2 377 2v18.75c-188.5 0-188.5-2-377-2z" style="fill:#f00"/>
           <path class="flow" data-index="15" d="m558 88.505c188.5 0 188.5 2 377 2v18.75c-188.5 0-188.5-2-377-2z" style="fill:#a52a2a"/>
           <path class="flow" data-index="16" d="m558 249.76c188.5 0 188.5-65.5 377-65.5v18.75c-188.5 0-188.5 65.5-377 65.5z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="17" d="m90 240.76c189 0 189 27.75 378 27.75v18.75c-189 0-189-27.75-378-27.75z" style="fill:#800080"/>
           <path class="flow" data-index="18" d="m558 216.01c189 0 189 48.75 378 48.75v18.75c-189 0-189-48.75-378-48.75z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="19" d="m558 107.26c189 0 189 138.75 378 138.75v18.75c-189 0-189-138.75-378-138.75z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="20" d="m558 268.51c189 0 189 15 378 15v18.75c-189 0-189-15-378-15z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="21" d="m558 302.26h378v18.75h-378z" style="fill:#d3d3d3"/>

           <rect class="node open-node" data-name="Manufacturing" x="5e-7" y="51.005" width="90" height="150" style="fill:#ececec"/>
           <text class="node-label" x="6.8730474" y="129.10774" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Manufacturing</text>

           <rect class="node open-node" data-subnode="true" data-name="Infrastructure" x="468" y="141.01" width="90" height="93.75" style="fill:#ececec"/>
           <text class="node-label" x="477.36621" y="192.16341" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Infrastructure</text>

           <rect class="node open-node" data-subnode="true" data-name="Buildings" x="468" y="51.005" width="90" height="75" style="fill:#ececec"/>
           <text class="node-label" x="488.37598" y="91.60775" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Buildings</text>

           <rect class="node" data-name="Imports" x="5e-7" y="283.51" width="90" height="37.5" style="fill:#ececec"/>
           <text class="node-label" x="24.65918" y="305.13803" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Imports</text>

           <rect class="node open-node" data-subnode="true" data-name="Landscaping" x="468" y="249.76" width="90" height="37.5" style="fill:#ececec"/>
           <text class="node-label" x="478.86621" y="271.60776" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Landscaping</text>

           <rect class="node open-node" data-name="Extraction" x="5e-7" y="222.01" width="90" height="37.5" style="fill:#ececec"/>
           <text class="node-label" x="18.219727" y="245.04427" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Extraction</text>

           <rect class="node open-node" data-name="Waste management" x="935" y="53.005" width="89.152" height="150" style="fill:#ececec"/>
           <text class="node-label" x="979.22168" y="123.38802" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1"><tspan x="979.22168" y="123.38802" style="text-align:center;text-anchor:middle">Waste</tspan><tspan x="979.22168" y="138.38802" style="text-align:center;text-anchor:middle">management</tspan></text>

           <rect class="node" data-name="Stock" x="935.85" y="246.01" width="89.152" height="75" style="fill:#ececec"/>
           <text class="node-label" x="995.14838" y="287.79428" text-anchor="end" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Stock</text>

           <rect class="node" data-name="Other" x="468" y="302.26" width="90" height="18.75" style="fill:#ececec"/>
           <text class="node-label" x="497.80957" y="315.91928" style="fill:#444444;font-family:'Open Sans', sans-serif;font-size:12px;white-space:pre" data-notex="1">Other</text>
          </svg>
        </div>

        <div class="nodesankey subnodesankey" data-name="Buildings" hidden>
          <div class="back-sankey border-end border-bottom open-node" data-name="Use"><i class="fal fa-arrow-left"></i> Back to use</div>
          <h4 class="text-center mb-4">Buildings</h4>
          <svg data-name="Buildings" viewBox="0 0 1206 270" xmlns="http://www.w3.org/2000/svg">
           <path class="flow" data-index="0" d="m90 12.525c234 0 234-12.525 468-12.525v46.227c-234 0-234 12.525-468 12.525z" style="fill:#ffd700"/>
           <path class="flow" data-index="1" d="m90 96.257c234 0 234-2.5099 468-2.5099v45.564c-234 0-234 2.5099-468 2.5099z" style="fill:#ffd700"/>
           <path class="flow" data-index="2" d="m90 179.33c234 0 234 7.5053 468 7.5053v45.648c-234 0-234-7.5053-468-7.5053z" style="fill:#ffd700"/>
           <path class="flow" data-index="3" d="m90 58.752c234 0 234-12.525 468-12.525v18.41c-234 0-234 12.525-468 12.525z" style="fill:#f00"/>
           <path class="flow" data-index="4" d="m90 141.82c234 0 234-2.5099 468-2.5099v18.41c-234 0-234 2.5099-468 2.5099z" style="fill:#f00"/>
           <path class="flow" data-index="5" d="m90 224.97c234 0 234 7.5053 468 7.5053v18.41c-234 0-234-7.5053-468-7.5053z" style="fill:#f00"/>
           <path class="flow" data-index="6" d="m90 77.162c234 0 234-12.525 468-12.525v19.095c-234 0-234 12.525-468 12.525z" style="fill:#a52a2a"/>
           <path class="flow" data-index="7" d="m90 160.23c234 0 234-2.5099 468-2.5099v19.095c-234 0-234 2.5099-468 2.5099z" style="fill:#a52a2a"/>
           <path class="flow" data-index="8" d="m90 243.38c234 0 234 7.5053 468 7.5053v19.095c-234 0-234-7.5053-468-7.5053z" style="fill:#a52a2a"/>
           <path class="flow" data-index="9" d="m648 49.38c234 0 234 117.52 468 117.52v34.367c-234 0-234-117.52-468-117.52z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="10" d="m648 142.46c234 0 234 58.801 468 58.801v34.367c-234 0-234-58.801-468-58.801z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="11" d="m648 235.63h468v34.367h-468z" style="fill:#d3d3d3"/>
           <path class="flow" data-index="12" d="m648 5e-7c234 0 234 10 468 10v34.779c-234 0-234-10-468-10z" style="fill:#ffd700"/>
           <path class="flow" data-index="13" d="m648 93.747c234 0 234-34.367 468-34.367v34.116c-234 0-234 34.367-468 34.367z" style="fill:#ffd700"/>
           <path class="flow" data-index="14" d="m648 186.83c234 0 234-78.734 468-78.734v34.2c-234 0-234 78.734-468 78.734z" style="fill:#ffd700"/>
           <path class="flow" data-index="15" d="m648 34.779c234 0 234 10 468 10v6.9542c-234 0-234-10-468-10z" style="fill:#f00"/>
           <path class="flow" data-index="16" d="m648 127.86c234 0 234-34.367 468-34.367v6.9542c-234 0-234 34.367-468 34.367z" style="fill:#f00"/>
           <path class="flow" data-index="17" d="m648 221.03c234 0 234-78.734 468-78.734v6.9542c-234 0-234 78.734-468 78.734z" style="fill:#f00"/>
           <path class="flow" data-index="18" d="m648 41.733c234 0 234 10 468 10v7.6473c-234 0-234-10-468-10z" style="fill:#a52a2a"/>
           <path class="flow" data-index="19" d="m648 134.82c234 0 234-34.367 468-34.367v7.6473c-234 0-234 34.367-468 34.367z" style="fill:#a52a2a"/>
           <path class="flow" data-index="20" d="m648 227.99c234 0 234-78.734 468-78.734v7.6473c-234 0-234 78.734-468 78.734z" style="fill:#a52a2a"/>
           <rect class="open-node node" data-name="Manufacturing" x="5e-7" y="12.525" width="90" height="249.95" style="fill:#ececec"/>
           <text class="node-label" x="6.8730474" y="140.60483" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;white-space:pre" data-notex="1">Manufacturing</text>
           <rect class="node" data-name="Commercial buildings" x="558" y="5e-7" width="90" height="83.747" style="fill:#ececec"/>
           <text class="node-label" x="603.09668" y="37.476135" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;white-space:pre" data-notex="1"><tspan x="603.09668" y="37.476135" style="text-align:center;text-anchor:middle">Commercial</tspan><tspan x="603.09668" y="52.476135" style="text-align:center;text-anchor:middle">buildings</tspan></text>
           <rect class="node" data-name="Social buildings" x="558" y="93.747" width="90" height="83.085" style="fill:#ececec"/>
           <text class="node-label" x="602.83008" y="130.89178" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;text-align:center;text-anchor:middle;white-space:pre" data-notex="1"><tspan x="602.83008" y="130.89178">Social</tspan><tspan x="602.83008" y="145.89178">buildings</tspan></text>
           <rect class="node" data-name="Residential buildings" x="558" y="186.83" width="90" height="83.168" style="fill:#ececec"/>
           <text class="node-label" x="602.90918" y="224.01869" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;text-align:center;text-anchor:middle;white-space:pre" data-notex="1"><tspan x="602.90918" y="224.01869">Residential</tspan><tspan x="602.90918" y="239.01869">buildings</tspan></text>
           <rect class="node" data-name="Stock" x="1116" y="166.9" width="90" height="103.1" style="fill:#ececec"/>
           <text class="node-label" x="1175.7246" y="222.73785" text-anchor="end" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;white-space:pre" data-notex="1">Stock</text>
           <rect class="open-node node" data-name="Waste management" x="1116" y="10" width="90" height="146.9" style="fill:#ececec"/>
           <text class="node-label" x="1160.6455" y="78.832031" text-anchor="end" style="fill:#444444;font-family:'Open Sans', verdana, arial, sans-serif;font-size:12px;white-space:pre" data-notex="1"><tspan x="1160.6455" y="78.832031" style="text-align:center;text-anchor:middle">Waste</tspan><tspan x="1160.6455" y="93.832031" style="text-align:center;text-anchor:middle">management</tspan></text>
          </svg>
        </div>

        <div class="nodesankey subnodesankey" data-name="Infrastructure" hidden>
          <div class="back-sankey border-end border-bottom open-node" data-name="Use"><i class="fal fa-arrow-left"></i> Back to use</div>
          <h4 class="text-center mb-4">Infrastructure</h4>
        </div>
        <div class="nodesankey subnodesankey" data-name="Landscaping" hidden>
          <div class="back-sankey border-end border-bottom open-node" data-name="Use"><i class="fal fa-arrow-left"></i> Back to use</div>
          <h4 class="text-center mb-4">Landscaping</h4>
        </div>

        <div class="nodesankey" data-name="Waste management" hidden>Waste management</div>
      </div>
    </div>

    <div class="btn btn-light toggle-table my-4">
      <i class="fa fa-caret-down me-2"></i> <span class="label">Data table</span>
    </div>
    <div id="table-wrapper" class="d-none mb-4">
      <table class="table" data-name="global">
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <table class="table" data-name="Use" hidden>
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <table class="table" data-name="Buildings" hidden>
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
  <script src="data.js"></script>

  <script>
    // some variables to keep track of things
    let scope = "global";
    let minimized = false;
    let selectedNode = "global";
    let selectedMaterial = false;

    function getNodeVar(svgName) {
      if (svgName == "global") {
        return "global_flows"
      } else if (svgName == "Use") {
        return "use_flows"
      } else if (svgName == "Buildings") {
        return "buildings_flows"
      } else if (svgName == "Extraction") {
        return "extraction_flows"
      }
    }

    function highlightNode(svgName, nodeName) {
      unhighlightNode(svgName)

      let svg = $("svg[data-name='" + svgName + "']");
      let node = svg.find(".node[data-name='" + nodeName + "']");

      node.addClass("active")
      svg.find(".flow").addClass("opaque");

      let dataVar = getNodeVar(svgName);

      $(window[dataVar]).each(function(i, flow) {
        if (flow.from == nodeName || flow.to == nodeName) {
          svg.find(".flow[data-index='" + i + "']").removeClass("opaque");
        }
      });
    }

    function unhighlightNode(svgName) {
      $("svg[data-name='" + svgName + "'] .flow").removeClass("opaque")
      $("svg[data-name='" + svgName + "'] .node").removeClass("active")
    }

    function openNodeSankey(nodeName, subNode) {
      minimized = true;

      $("#col-svg").addClass("col-6 minimized").removeClass("col-12");
      $("#nodesankey-wrapper .nodesankey").attr("hidden", "hidden")

      $(".sankey-wrapper, #nodesankey-wrapper .nodesankey[data-name='" + nodeName + "']").removeAttr("hidden")

      if (!subNode) {
        highlightNode("global", nodeName)
      } else {
        unhighlightNode(selectedNode)
      }

      openTable(nodeName);

      selectedNode = nodeName;

      scrollTo(".sankey-wrapper")
    }

    function closeNodeSankey() {
      $(".sankey-wrapper").attr("hidden", "hidden");
      $("#col-svg").toggleClass("col-6 col-12 minimized");

      openTable("global");

      scrollTo("#col-svg")

      unhighlightNode("global")
      unhighlightNode(selectedNode)
      selectedNode = false
      minimized = false
    }

    function openTable(node) {
      $("#table-wrapper table").attr("hidden", "hidden")
      $("#table-wrapper table[data-name='" + node + "']").removeAttr("hidden")
    }

    $(".node").hover(
      function() {
        let svgName = $(this).parent("svg").data("name");
        let nodeName = $(this).data("name");
        highlightNode(svgName, nodeName)
      }, function() {
        if (minimized) {
          unhighlightNode(selectedNode)
        } else {
          unhighlightNode("global")
        }
      }
    );

    $(".open-node").click(function() {
      let thisNode = $(this)

      let nodeName = thisNode.data("name");
      let subNode = false;

      if (thisNode.attr("data-subnode")) {
        subNode = true;
      }

      openNodeSankey(nodeName, subNode)
    })

    $(".close-sankey").click(function() {
      closeNodeSankey()
    })

    function highlightMaterial(material) {

    }

    $(".select-material").click(function() {
      $(".flow:not(.opaque)").addClass("opaque")
      $(".node").removeClass("active")

      $("#inputs-ouputs").attr("hidden", "hidden");
      $("#category").removeAttr("hidden");

      let category = $(this).data("material")
      highlightMaterial(category)
    })

    // generic function to smoothly scroll to a jquery object
    function scrollTo(object) {
      $("html, body").animate({
        scrollTop: $(object).offset().top - 200
      }, 300);
    }

    $(".toggle-table").click(function() {
      $("#table-wrapper").toggleClass("d-none");
      $(".toggle-table i").toggleClass("fa-caret-down fa-caret-up")
    })

    const flowPopup = $("#popup");

    // follow cursor around
    $(".flow").mouseenter(function() {
      $(this).addClass("hover")
      flowPopup.show();
      let flowIndex = $(this).data("index")
      updatePopup(flowIndex)
    });

    $(".flow").mousemove(function(e) {
      flowPopup.css({
        left: e.pageX,
        top:  e.pageY,
      });
    });

    $(".flow").mouseleave(function() {
      $(this).removeClass("hover")
      flowPopup.hide();
    });

    // update popup
    function updatePopup(flowIndex) {
      let dataVar = getNodeVar(selectedNode);
      let flowData = $(window[dataVar])[flowIndex]

      $("#popup-from").html(flowData.from)
      $("#popup-to").html(flowData.to)
      $("#popup-value").html(flowData.value)
      $("#popup-material").html(flowData.material)
    }
  </script>
</body>
</html>

