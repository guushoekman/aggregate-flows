  <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aggregate Flows</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-VhBcF/php0Z/P5ZxlxaEx1GwqTQVIBu4G4giRWxTKOCjTxsPFETUDdVL5B6vYvOt" crossorigin="anonymous">
  <style>
    svg {
      width: 100%;
      height: auto;
    }

    #popup {
      position: absolute;
      display: none;
      z-index: 100000;
      pointer-events: none;
      font-size: 12px;
    }

    #col-svg {
      transition: width .3s;
    }

    #col-svg.minimized .svg-wrapper {
      cursor: pointer;
    }

    #col-svg.minimized svg {
      pointer-events: none;
    }

    .flow {
      cursor: help;
    }

    .auntnode,
    .subnode,
    .node {
      cursor: pointer;
    }

    .flow.opaque {
      opacity: .1;
    }

    .flow.hover {
      opacity: .5;
    }

    .popover-header,
    .popover-body {
      padding: 6px 12px;
    }

    .node.active {
      stroke: #000;
    }

    text {
      pointer-events: none;
      font-family: 'Liberation Sans', sans-serif;
      font-size: 12px;
    }

    table.table {
      margin-bottom: 0;
    }

    .select-material {
      width: 100%;
    }

    .cover {
      position: absolute;
      left: 0;
      top: 0;
      width: 0;
      height: 0;
      pointer-events: none;
    }

    #col-svg.minimized .cover {
      pointer-events: unset;
      width: 100%;
      height: 100%;
      background-color: transparent;
    }

    .back-sankey {
      position: absolute;
      top: 0;
      left: 0;
      line-height: 1.5rem;
      background-color: #efefef;
      cursor: pointer;
      padding: .25rem .5rem;
      font-size: 12px;
    }

    .back-sankey i {
      margin-right: .25rem;
    }

    .x-button {
      position: absolute;
      top: 0;
      right: 0;
      height: 1.5rem;
      width: 1.5rem;
      line-height: 1.5rem;
      background-color: #efefef;
      cursor: pointer;
      text-align: center;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg bg-light">
    <div class="container">
      <a class="navbar-brand" href="#">Aggregate flows</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded=false aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>
  </nav>

  <div id="popup" class="p-1 border rounded bg-white">
    <div>
      <span id="popup-from"></span>
      <span><i class="fal fa-arrow-right mx-1"></i></span>
      <span id="popup-to"></span>
    </div>
    <div>
      <span id="popup-value"></span>kt of
      <span id="popup-material"></span>
    </div>
  </div>
  <div class="container pt-4">
<!--
    <h2>Highlight by material</h2>
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="select-material btn btn-outline-primary" data-material="Sand and gravel">
          <i class="fal fa-fw me-1 fa-umbrella-beach"></i> Sand and gravel
        </div>
      </div>
      <div class="col-md-3">
        <div class="select-material btn btn-outline-danger" data-material="Rock">
          <i class="fal fa-fw me-1 fa-mountain"></i> Rock
        </div>
      </div>
    </div>
 -->
    <div class="row">
      <div id="col-svg" class="col-12">
        <div class="svg-wrapper position-relative p-3">
          <div class="close-sankey cover"></div>
          <svg data-name="global" class="global-view" width="2000" height="500" viewBox="0 0 505.88 132.03" xmlns="http://www.w3.org/2000/svg">
            <text x="196" y="5" font-size="6">Export</text>
            <text x="302" y="5" font-size="6">Import</text>
            <text x="390" y="5" font-size="6">Import</text>

            <!-- reserves to extraction -->
            <rect class="flow" data-index="0" x="40.217" y="42.598" width="52.917" height="24.342"/>
            <rect class="flow" data-index="1" x="40.217" y="66.94" width="52.917" height="11.642"/>
            <rect class="flow" data-index="2" x="40.217" y="78.581" width="52.917" height="4.2333"/>

            <!-- extraction to processing -->
            <rect class="flow" data-index="3" x="133.35" y="47.625" width="52.917" height="8.7312"/>
            <rect class="flow" data-index="4" x="133.35" y="56.356" width="52.917" height="21.431"/>

            <!-- extraction to waste -->
            <path class="flow" data-index="5" d="m109.01 82.814v49.213h379.68v-49.213h-2.9103v46.302h-373.86v-46.302z"/>

            <!-- extraction to use -->
            <path class="flow" data-index="6" d="m114.56 82.815v43.127h288.66v-43.127h-2.9104v40.217h-282.84v-40.217z"/>

            <!-- processing to manufacturing -->
            <rect class="flow" data-index="7" x="226.48" y="52.387" width="52.917" height="3.175"/>
            <rect class="flow" data-index="8" x="226.48" y="55.562" width="52.917" height="3.175"/>
            <rect class="flow" data-index="9" x="226.48" y="58.737" width="52.917" height="5.0271"/>
            <rect class="flow" data-index="10" x="226.48" y="63.765" width="52.917" height=".79375"/>
            <rect class="flow" data-index="11" x="226.48" y="64.558" width="52.917" height=".79375"/>
            <rect class="flow" data-index="12" x="226.48" y="65.352" width="52.917" height="1.3229"/>
            <rect class="flow" data-index="13" x="226.48" y="66.675" width="52.917" height="1.8521"/>

            <!-- processing to export -->
            <rect class="flow" data-index="14" x="191.56" width="1.5875" height="42.598"/>

            <!-- processing to waste -->
            <path class="flow" data-index="15" d="m192.62 82.815v37.835h290.51v-37.835h-3.175v34.66h-284.16v-34.66z"/>

            <!-- processing to use -->
            <path class="flow" data-index="16" d="m200.55 82.815v31.485h193.67v-31.485h-2.6458v28.84h-188.38v-28.84z"/>
            <path class="flow" data-index="17" d="m203.2 82.815v28.84h188.39v-7.6729h-6e-3v-21.167h-7.6729v21.167h-173.04v-21.167z"/>

            <!-- waste to processing -->
            <path class="flow" data-index="18" d="m205.58 24.077v18.521h10.848v-7.6729h275.17v7.6729h10.848v-18.521h-10.848z"/>
            <path class="flow" data-index="19" d="m216.43 34.925v7.6729h1.5875v-6.0854h271.99v6.0854h1.5875v-7.6729h-273.58z"/>

            <!-- manufacturing to use -->
            <rect class="flow" data-index="20" x="319.62" y="60.854" width="52.917" height="1.0583"/>
            <rect class="flow" data-index="21" x="319.62" y="61.912" width="52.917" height="4.2333"/>

            <!-- manufacturing to waste -->
            <path class="flow" data-index="22" d="m297.92 82.815v14.817h179.92v-14.817h-2.9104v11.906h-174.1v-11.906z"/>

            <!-- import to manufacturing -->
            <rect class="flow" data-index="23" x="297.92" width="2.1167" height="42.598"/>

            <!-- import to use -->
            <rect class="flow" data-index="24" x="385.43" width="2.3812" height="44.319"/>

            <!-- use to waste -->
            <rect class="flow" data-index="25" x="412.75" y="59.531" width="52.917" height="7.4083"/>

            <!-- waste to use -->
            <path class="flow" data-index="26" d="m393.7 37.306v5.2917h1.3229v-3.9688h90.488v3.9688h1.3229v-5.2917h-91.81z"/>

            <!-- nodes -->
            <rect class="node open-node" data-name="Reserves" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="6.8749571" y="65.075249"><tspan x="6.8749571" y="65.075249" style="fill:#000000;font-family:FreeSans;font-size:6.35px;">Reserves</tspan></text>

            <rect class="node open-node" data-name="Extraction" x="93.133" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="99.389206" y="65.075249"><tspan x="99.389206" y="65.075249" style="fill:#000000;font-family:FreeSans;font-size:6.35px;">Extraction</tspan></text>

            <rect class="node open-node" data-name="Processing/Production" x="186.27" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="206.89563" y="60.359631"><tspan x="206.89563" y="60.359631" style="fill:#000000;font-family:FreeSans;font-size:6.35px;text-align:center;text-anchor:middle">Processing / </tspan><tspan x="206.89563" y="68.55262" style="fill:#000000;font-family:FreeSans;font-size:6.35px;text-align:center;text-anchor:middle">production</tspan></text>

            <rect class="node open-node" data-name="Manufacturing" x="279.4" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="299.45193" y="64.284325"><tspan x="299.45193" y="64.284325" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Manufacturing</tspan></text>

            <rect class="node open-node" data-name="Use" x="372.53" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="392.58527" y="64.284325"><tspan x="392.58527" y="64.284325" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Use</tspan></text>

            <rect class="node open-node" data-name="Waste management" x="465.67" y="42.598" width="40.217" height="40.217" fill="#ececec"/>
            <text x="485.66217" y="60.634529"><tspan x="485.66217" y="60.634529" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">Waste</tspan><tspan x="485.66217" y="67.917183" style="fill:#000000;font-family:FreeSans;font-size:5.6444px;text-align:center;text-anchor:middle">management</tspan></text>
          </svg>
        </div>
      </div>
    </div>

    <div class="sankey-wrapper position-relative border p-4 my-4" hidden>
      <div class="close-sankey border-start border-bottom x-button"><i class="fal fa-times"></i></div>

      <div id="nodesankey-wrapper">
        <div class="nodesankey" data-name="Reserves" hidden>Reserves</div>
        <div class="nodesankey" data-name="Extraction" hidden>
          <h4 class="text-center">Extraction</h4>

          <svg data-name="Extraction" viewBox="0 0 1169 422.92" xmlns="http://www.w3.org/2000/svg">
            <path class="flow" data-index="0" d="m530.8 34.041c-112.5 0-112.5 11.186-225 11.186s-142.5-4.584-255-4.584v223.19c105.22 0 139.12 3.9636 235 4.4824v0.10156h20c112.5 0 112.5-11.186 225-11.186l10-111.59z" style="fill:#ae9e80"/>
            <path class="flow" data-index="1" d="m530.8 257.23c-112.5 0-112.5 19.184-225 19.184h-20c-112.5 0-122.5-12.584-235-12.584v63.957c112.26 0 123.17 10.652 235 10.697 0.011 1e-5 0.0203 0 0.0312 0 0.22632 9e-5 0.41738 4e-3 0.64453 4e-3v-4e-3h19.324c111.85-0.0391 118.31-19.187 229.77-19.297l5.2324-21.283z" style="fill:#dec580"/>
            <path class="flow" data-index="2" d="m50.801 327.79v42.666c112.49 0 122.53 37.981 235 37.988v2e-3h40c105.13 0 116.51-24.243 209.35-27.42l5.6504-15.326-10-27.121c-112.5 0-112.5 27.186-225 27.186v-2e-3h-20c-112.5 0-122.5-37.973-235-37.973z" style="fill:#f2f78a"/>
            <path class="flow" data-index="3" d="m535.57 319.19c-111.46 0.11014-117.92 19.258-229.77 19.297h-20v0.0117c-111.85 0.16392-122.73 39.957-235 39.957v17.391c112.5 0 122.5-38.084 235-38.084h20v2e-3c112.5 0 112.5-19.186 225-19.186z" style="fill:#dec580"/>
            <path class="flow" data-index="4" d="m535.15 381.02c-111.87 0.10719-117.99 25.893-230.26 27.492l-19.055-0.0742-0.0332 11.561 20.148 0.29492c112.49 1.65 112.22-27.133 224.72-27.133zm-249.35 38.979v-5.7871l0.0332-5.7734c-112.5 0-122.53-12.598-235.03-12.598v11.574c112.5 0 122.5 12.584 235 12.584z" style="fill:#f2f78a"/>
            <path class="flow" data-index="5" d="m825.8 2e-3c-112.5 0-122.5 34.039-235 34.039v202.84c112.5 0 122.5-34.039 235-34.039h20c112.5 0 112.5 3.6445 225 3.6445l10-101.42-10-101.42c-112.5 0-112.5-3.6465-225-3.6465z" style="fill:#ae9e80"/>
            <path class="flow" data-index="6" d="m1070.8 206.49c-112.5 0-112.5 4.3555-225 4.3555h-20c-112.5 0-122.5 26.039-235 26.039v58.127c112.5 0 122.5-26.041 235-26.041h20c112.5 0 112.5-4.3535 225-4.3535l10-29.064z" style="fill:#dec580"/>
            <path class="flow" data-index="7" d="m1070.8 264.61c-112.5 0-112.5 12.354-225 12.354h-20c-112.5 0-122.5 18.041-235 18.041v39.367c112.5 0 122.5-18.039 235-18.039h20c112.5 0 112.5-12.355 225-12.355l10-19.684z" style="fill:#f2f78a"/>
            <path class="flow" data-index="8" d="m825.8 324.34c-112.5 0-122.5 10.039-235 10.039v23.664c112.5 0 122.5-10.039 235-10.039h20c112.5 0 112.5 2.9062 225 2.9062l10-11.834-10-11.832c-112.5 0-112.5-2.9043-225-2.9043z" style="fill:#ae9e80"/>
            <path class="flow" data-index="9" d="m1070.8 350.91c-112.5 0-112.5 5.0938-225 5.0938h-20c-112.5 0-122.5 2.0391-235 2.0391v4.9375c112.5 0 122.5-2.041 235-2.041h20c112.5 0 112.5-5.0938 225-5.0938l10-2.4688z" style="fill:#dec580"/>
            <path class="flow" data-index="10" d="m1070.8 355.84c-112.5 0-112.5 13.094-225 13.094h-20c-112.5 0-122.5-5.959-235-5.959v3.3301c112.5 0 122.5 5.959 235 5.959h20c112.5 0 112.5-13.094 225-13.094l10-1.666z" style="fill:#f2f78a"/>
            <path class="flow" data-index="11" d="m590.8 366.31v16.002c112.5 0 122.5 13.961 235 13.961h20c112.5 0 112.5 3.5469 225 3.5469l10-8.002-10-8c-112.5 0-112.5-3.5488-225-3.5488h-20c-112.5 0-122.5-13.959-235-13.959z" style="fill:#ae9e80"/>
            <path class="flow" data-index="12" d="m590.8 382.31v4.9375c112.5 0 122.5 21.959 235 21.959h20c112.5 0 112.5-4.4512 225-4.4512l10-2.4688-10-2.4688c-112.5 0-112.5 4.4531-225 4.4531h-20c-112.5 0-122.5-21.961-235-21.961z" style="fill:#dec580"/>
            <path class="flow" data-index="13" d="m590.8 387.25v2.793c112.5 0 122.5 29.961 235 29.961h20c112.5 0 112.5-12.453 225-12.453l10-1.3965-10-1.3965c-112.5 0-112.5 12.451-225 12.451h-20c-112.5 0-122.5-29.959-235-29.959z" style="fill:#f2f78a"/>

            <rect class="node" data-name="Terrestrial" x=".80176" y="40.37" width="50" height="329.81" style="fill:#c48d98"/>
            <text class="node-label" x="-0.26953125" y="209.74858">Terrestrial</text>

            <rect class="node" data-name="Marine" x=".80176" y="378.45" width="50" height="28.964" style="fill:#c5e9df"/>
            <text class="node-label" x="7.2363272" y="397.40765">Marine</text>

            <text class="node-label" x="281.90302" y="395.22574">Sand</text>
            <text class="node-label" x="278.23004" y="320.74017">Gravel</text>
            <text class="node-label" x="257.47217" y="155.70261">Crushed Rock</text>

            <rect class="node" data-name="Extraction" x="540.8" y="33.766" width="50" height="358.78" style="fill:#a7e66f"/>
            <text class="node-label" x="539.02094" y="217.62968">Extraction</text>

            <text class="node-label" x="823.82397" y="300.85342">Sand</text>
            <text class="node-label" x="819.28552" y="245.22638">Gravel</text>
            <text class="node-label" x="797.33405" y="105.62245">Crushed Rock</text>
            <text class="node-label" x="823.81482" y="374.80301">Sand</text>
            <text class="node-label" x="819.28552" y="362.66995">Gravel</text>
            <text class="node-label" x="797.33405" y="340.37012">Crushed Rock</text>
            <text class="node-label" x="823.69849" y="421.01978">Sand</text>
            <text class="node-label" x="819.78296" y="408.74667">Gravel</text>
            <text class="node-label" x="797.54596" y="391.91196">Crushed Rock</text>

            <rect class="node open-node" data-name="Processing/Production" x="1080.8" y="3.648" width="50" height="300.34" style="fill:#a7e66f"/>
            <text class="node-label" x="1138.2937" y="149.62854" text-anchor="end"><tspan x="1138.2937" y="149.62854">Processing /</tspan><tspan x="1138.2937" y="164.62854">production</tspan></text>

            <rect class="node" data-name="Use as Fill" x="1080.8" y="326.97" width="50" height="31.93" style="fill:#ca91fd"/>
            <text class="node-label" x="1133.7146" y="347.40802" text-anchor="end">Use as Fill</text>

            <rect class="node" data-name="Waste Processing" x="1080.8" y="383.81" width="50" height="23.734" style="fill:#d980b7"/>
            <text class="node-label" x="1154.2605" y="399.88309" text-anchor="end">Waste Processing</text>
          </svg>

        </div>

        <div class="nodesankey" data-name="Processing/Production" hidden>
          <h4 class="text-center">Processing/Production</h4>
          <svg data-name="Processing/Production" viewBox="0 0 1056.2 389.01" xmlns="http://www.w3.org/2000/svg">
            <path data-index="0" class="flow" d="m981.48 8.266c-352.85 0-352.85 4.6543-705.7 4.6543h-48c-65.708 0-76.707 9.3008-142.42 9.3008v5.9707c65.713 0 76.712-9.3008 142.42-9.3008h50v-0.0039c350.6-0.01979 351.6-4.6504 703.7-4.6504l10-2.9863z" style="fill:#ae9e80"/>
            <path data-index="1" class="flow" d="m227.78 18.891c-65.708 0-76.707 9.3008-142.42 9.3008v10.049c63.315-1.1669 78.696-10.529 148.83-10.529h41.584c257.14 0 268.14 241 525.28 241h50.059v-8.834c64.637-0.34161 65.025-31.281 130.38-31.281l10-1.8262-0.012-2e-3 -9.9512-0.14649c-65.717 0-65.717 31.297-131.43 31.297v1.5293h-48.986v-8e-3c-256.46 0-268.16-239.26-523.33-240.52v-0.0293h-2z" style="fill:#ae9e80"/>
            <path data-index="2" class="flow" d="m233.19 27.717c-70.134 0-84.515 9.3566-147.83 10.523l-0.0058 74.452c65.708 0 75.713-9.3021 141.43-9.3021h49.193c65.518 0.0855 65.59 42.314 131.24 42.314l10-37.832-10-37.834c-65.373 0-65.741-41.861-130.43-42.299v-0.02344z" style="fill:#ae9e80" sodipodi:nodetypes="sccsccccccs"/>
            <path data-index="3" class="flow" d="m981.48 14.241c-352.85 0-352.85 100.32-705.7 100.32v-2e-3h-50v-2e-3c-65.708 0-76.707-1.8692-142.42-1.8691v1.4922c65.713 0 76.712 1.8691 142.42 1.8691v2e-3h50v2e-3c352.85 0 352.85-100.32 705.7-100.32l10-0.74609z" style="fill:#dec580"/>
            <path data-index="4" class="flow" d="m83.359 114.18v21.688c65.713 0 76.712 1.8691 142.42 1.8691v2e-3h50v-6e-3c65.717 0 65.717 29.658 131.43 29.658l10-10.842-10-10.842c-65.717 0-65.717-29.658-131.43-29.658v2e-3h-50v-2e-3c-65.708 0-76.707-1.8691-142.42-1.8691z" style="fill:#dec580"/>
            <path data-index="5" class="flow" d="m83.359 135.86v1.834c65.708 0 76.707 1.8691 142.42 1.8691h50c257.14 0 268.14 141.27 525.27 141.27v0.0117h50v-1.7656h-49.678c-257.14 0-268.45-141.35-525.59-141.35v4e-3h-50v-2e-3c-65.708 0-76.707-1.8691-142.42-1.8691zm905.48 95.434-7.3516 0.17382c-65.713 0-65.713 46.125-131.43 46.125v1.4004c65.717 0 65.717-46.125 131.43-46.125z" style="fill:#dec580"/>
            <path data-index="6" class="flow" d="m981.48 15.73c-352.85 0-352.85 130.34-705.7 130.34v-2e-3h-49.998l-2e-3 -8e-3c-65.708 0-76.707-8.3652-142.42-8.3652v1.043c65.713 1e-5 76.712 8.3652 142.42 8.3652l2e-3 8e-3h49.998v2e-3c352.85 0 352.85-130.34 705.7-130.34l10-0.52148z" style="fill:#f2f78a"/>
            <path data-index="7" class="flow" d="m83.359 138.74v14.162c65.713 0 76.712 8.3652 142.42 8.3652l2e-3 6e-3h49.998v0.5254c65.717 0 65.717 20.279 131.43 20.279l10-7.3418-10-7.3438c-65.717 0-65.717-20.279-131.43-20.279v-2e-3h-49.998l-2e-3 -6e-3c-65.708 0-76.707-8.3652-142.42-8.3652zm192.42 6.8047v0.52344h2e-3v-0.52344z" style="fill:#f2f78a"/>
            <path data-index="8" class="flow" d="m83.359 152.9v1.7734c65.708 0 76.707 8.3633 142.42 8.3633v6e-3h50c257.14 0 268.14 126.9 525.28 126.9h50v-0.96875h-50v2e-3c-256.86-0.09569-268.24-127.18-525.28-127.18v-0.5293h-49.998l-2e-3 -6e-3c-65.708 0-76.707-8.3652-142.42-8.3652zm904.82 80.881-6.6934 0.91211c-65.713 0-65.713 53.1-131.43 53.1v0.89844c65.717 0 65.717-53.098 131.43-53.098l10-1.3613z" style="fill:#f2f78a"/>
            <path data-index="9" class="flow" d="m84.359 201.46c161.43 0 161.43-19.383 322.85-19.383l10 15.152-10 15.152c-161.43 0-161.43 19.383-322.85 19.383z" style="fill:#a5d7d4"/>
            <path data-index="10" class="flow" d="m84.359 274.63c161.43 0 161.43-62.252 322.85-62.252l10 2.3274-10 2.3274c-161.43 0-161.43 62.252-322.85 62.252z" style="fill:#a5d7d4"/>
            <path data-index="11" class="flow" d="m84.359 308.19c161.43 0 161.43-91.152 322.85-91.152l10 0.2685-10 0.26849c-161.43 0-161.43 91.152-322.85 91.152z" style="fill:#f2f78a"/>
            <path data-index="12" class="flow" d="m84.359 334.97c161.43 0 161.43-117.4 322.85-117.4l10 3.1032-10 3.1032c-161.43 0-161.43 117.4-322.85 117.4z" style="fill:#a5d7d4"/>
            <path data-index="13" class="flow" d="m981.48 65.597c-161.42 0-161.42 0.60352-322.85 0.60352h-50c-65.708 0-74.707 3.8398-140.42 3.8398l-6e-3 7.9219c65.713 0 74.718-3.8613 140.43-3.8613h50c161.42 0 161.42-0.60352 322.85-0.60352l10-3.9492z" style="fill:#ae9e80"/>
            <path data-index="14" class="flow" d="m608.63 74.1c-65.708 0-76.707 3.8379-142.42 3.8379v12.633c65.713 0 76.712-3.8379 142.42-3.8379h50v2e-3c161.42 0 161.42 61.018 322.85 61.018l10-6.3164-10-6.3184c-161.42 0-161.42-61.018-322.85-61.018z" style="fill:#ae9e80"/>
            <path data-index="15" class="flow" d="m608.63 86.735c-64.971 0-76.644 3.7381-140.42 3.8223v5.1562c63.776-0.0842 75.449-3.8223 140.42-3.8223h50v2e-3c161.42 0 161.42 101.83 322.85 101.83l10-2.5762-10-2.5762c-161.42 0-161.42-101.83-322.85-101.83v-0.0059z" style="fill:#ae9e80" sodipodi:nodetypes="sccscccccccs"/>
            <path data-index="16" class="flow" d="m608.63 66.192v0.0098h50v-0.0098zm0 20.543c-64.971 0-76.644 3.7381-140.42 3.8223v2e-3c63.776-0.0842 75.449-3.8223 140.42-3.8223h50v-2e-3zm50 5.1562v2e-3h-50c-64.971 0-76.644 3.7381-140.42 3.8223v2.7188c63.776-0.0842 75.449-3.8223 140.42-3.8223h50v-0.0059c161.42 0 161.42 175.12 322.85 175.12l10-1.3594-10-1.3574c-161.42 0-161.42-175.12-322.85-175.12z" style="fill:#ae9e80"/>
            <path data-index="17" class="flow" d="m658.62 66.209v20.525h-50c-6.8755 0-12.855 0.0615-18.658 0.13672 5.7994-0.0748 11.793-0.13477 18.658-0.13477h50v3.6446h6e-3v-20.525h4e-3v-3.6465zm0 24.174v4.2285h-50c-64.967 0-76.644 3.7377-140.41 3.8223v6.3477h6e-3v-2.7012c63.767-0.0846 75.443-3.8223 140.41-3.8223h50v-7.875zm-189.61 0.16602c-0.28816 5.4e-4 -0.54226 0.0029-0.80274 0.0059v0.0039c0.29327-1e-3 0.5098-0.0088 0.80274-0.0098zm189.62 4.0605 6e-3 3.6484c65.712 0 76.766 161.19 142.48 161.19h48.943v0.44335c0.0134 0 0.0256 1e-5 0.0391 0v-0.44335h0.96289v-1.543c64.726-0.31218 65.081-31.283 130.47-31.283l9.9629 0.14649-10-1.8242c-65.673 0-65.723 31.253-131.3 31.295h-49.127v2e-3c-65.717 0-76.717-161.63-142.43-161.63z" style="fill:#ae9e80"/>
            <path data-index="18" class="flow" d="m608.62 98.258c-64.967 0-76.644 3.7377-140.41 3.8223v2.6914c65.702-2.5e-4 76.703-3.8379 142.41-3.8379v-2e-3c17.667-0.0433 35.606 0.01 53.01 0.01 7.0654 1e-5 12.793 5.7276 12.793 12.793v255.41c-2e-5 7.0654-5.7276 12.793-12.793 12.793h-644.28c-7.0654-3e-5 -12.793-5.7276-12.793-12.793v-17.963c1.7e-5 -7.0654 5.7276-12.793 12.793-12.793h5l10-1.3398-10-1.3379h-5c-8.5442 1.6e-4 -15.471 6.9265-15.471 15.471v17.963c1.66e-4 8.5442 6.9265 15.471 15.471 15.471h644.28c8.5442-1.6e-4 15.471-6.9265 15.471-15.471v-255.41c-1.7e-4 -8.5442-6.9265-15.471-15.471-15.471-18.179 0.049-36.681-0.0059-55.014-0.0059z" style="fill:#ae9e80" sodipodi:nodetypes="ccccccccccssscccccccccccc"/>
            <path data-index="19" class="flow" d="m981.48 73.504c-161.42 0-161.42 44.477-322.85 44.477h-47.998l-2e-3 -6e-3c-65.708 0-76.707-13.203-142.42-13.203v7.4199c65.713 0 76.712 13.203 142.42 13.203l2e-3 6e-3h47.998v2e-3c161.42 0 161.42-44.477 322.85-44.477l10-3.7109z" style="fill:#dec580"/>
            <path data-index="20" class="flow" d="m468.21 112.2v3.8652c65.711 2.8e-4 76.711 13.203 142.42 13.203l2e-3 6e-3h47.998v-6e-3c161.42 1.9e-4 161.42 22.357 322.85 22.357l10-1.9336-10-1.9316c-161.42 0-161.42-22.357-322.85-22.357v6e-3h-47.996l-2e-3 -6e-3c-65.707 0-76.707-13.203-142.42-13.203z" style="fill:#dec580"/>
            <path data-index="21" class="flow" d="m468.22 116.06v1.5c65.704 1e-3 76.706 13.203 142.41 13.203l2e-3 6e-3h47.998v-0.0117c161.42 5.4e-4 161.42 64.461 322.85 64.461l10-0.75-10-0.75c-161.42 0-161.42-64.461-322.85-64.461v0.0117h-49.998v-0.0195c-63.91-0.26935-75.395-13.188-140.41-13.19z" style="fill:#dec580"/>
            <path data-index="22" class="flow" d="m468.22 117.56v0.2207c65.704 1e-3 76.706 13.203 142.41 13.203l2e-3 6e-3h47.998v-0.0176c161.42 1e-3 161.42 138.96 322.85 138.96l10-0.10742-10-0.10547c-161.42 0-161.42-138.96-322.85-138.96v0.0117h-49.998v-0.0195c-63.91-0.2693-75.395-13.188-140.41-13.19z" style="fill:#dec580"/>
            <path data-index="23" class="flow" d="m468.22 117.78v3.0117c65.708 8.3e-4 76.708 13.203 142.41 13.203l2e-3 6e-3h47.998v-0.0117c65.687 6e-3 76.768 143.5 142.42 143.61v6e-3l50.008-4e-3v-1.5078c64.689-0.47762 65.057-46.104 130.43-46.104l6.5762 8e-3 -6.5762-1.4082c-65.717 0-65.717 46.125-131.43 46.125v6e-3h-49c-65.717 0-76.717-143.74-142.43-143.74v0.0117h-49.998v-0.0195c-63.91-0.26988-75.395-13.189-140.41-13.19z" style="fill:#dec580"/>
            <path data-index="24" class="flow" d="m468.22 120.8v1.793c65.713 0 76.712 13.203 142.42 13.203l2e-3 6e-3h47.998c65.705 0.0228 76.819 188.76 142.53 188.76l-0.10938-1.5868c-65.717 0-76.711-188.97-142.42-188.97l-50.004 1.7e-4v-0.0195c-63.91-0.26938-75.395-13.188-140.41-13.19z" style="fill:#dec580" sodipodi:nodetypes="cccccccccccccc"/>
            <path data-index="25" class="flow" d="m468.22 122.59v0.88281c65.024 0 76.507 12.92 140.42 13.189v0.0195h50l4.998-0.0137c6.5782-0.0182 11.912 5.3319 11.912 11.91v220.57c0 6.5783-5.3338 11.91-11.912 11.91h-644.28c-6.5783 0-11.912-5.3319-11.912-11.91v-17.963c5.523e-4 -6.5779 5.3342-11.91 11.912-11.91h5l10-0.4414-10-0.44141h-5c-7.0654 0-12.793 5.7276-12.793 12.793v17.963c0 7.0654 5.7276 12.793 12.793 12.793h644.28c7.0654 0 12.793-5.7276 12.793-12.793v-220.57c0-7.0654-5.7276-12.793-12.793-12.793l-5.0078 0.0137h-50v-0.0195c-63.91-0.26924-75.395-13.188-140.41-13.19z" style="fill:#dec580"/>
            <path data-index="26" class="flow" d="m981.48 80.926c-161.42 0-161.42 70.844-322.85 70.844h-47.998l-2e-3 -6e-3c-65.708 0-76.707-28.303-142.42-28.303v12.332c65.713 0 76.712 28.303 142.42 28.303l2e-3 8e-3h47.998c161.42 0 161.42-70.844 322.85-70.844l10-6.168z" style="fill:#f2f78a"/>
            <path data-index="27" class="flow" d="m468.21 135.79v2.2422c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998c161.42 0 161.42-12.479 322.85-12.479l10-1.1211-10-1.123c-161.42 0-161.42 12.479-322.85 12.479v4e-3h-50v-0.0332c-63.913-0.57708-75.396-28.277-140.42-28.277z" style="fill:#f2f78a"/>
            <path data-index="28" class="flow" d="m468.21 138.03v0.68554c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998v-4e-3c161.42 0 161.42 28.883 322.85 28.883l10-0.34179-10-0.3418c-161.42 0-161.42-28.883-322.85-28.883v4e-3h-50v-0.0332c-63.913-0.57708-75.396-28.277-140.42-28.277z" style="fill:#f2f78a"/>
            <path data-index="29" class="flow" d="m468.21 138.72v0.34375c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998v-4e-3c161.42 0 161.42 102.91 322.85 102.91l10-0.16797-10-0.16797c-161.42 0-161.42-102.91-322.85-102.91v-2e-3h-50v-0.0332c-63.913-0.57708-75.396-28.277-140.42-28.277z" style="fill:#f2f78a"/>
            <path data-index="30" class="flow" d="m468.22 139.06v3.4336c65.704 3e-3 76.706 28.303 142.41 28.303l2e-3 6e-3h47.998v-4e-3c161.42 0 161.42 195.22 322.85 195.22l10-1.7188-10-1.7188c-161.42 0-161.42-195.22-322.85-195.22v0.01h-50v-0.0332c-63.91-0.57705-75.395-28.274-140.41-28.277z" style="fill:#f2f78a"/>
            <path data-index="31" class="flow" d="m468.21 142.49v1.791c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998c65.674 0 76.807 115.16 142.43 115.28v0.01h50v-1.0254c64.704-0.54145 65.051-53.086 130.43-53.086l6.6992 0.91211 3.3008-0.44922-10-1.3613c-65.717 0-65.717 53.098-131.43 53.098v2e-3h-49c-65.717 0-76.717-115.17-142.43-115.17h-50v-0.0332c-63.913-0.5775-75.396-28.278-140.42-28.278z" style="fill:#f2f78a"/>
            <path data-index="32" class="flow" d="m468.21 144.28v1.2422c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998v-2e-3c65.717 0 76.717 152.17 142.43 152.17l0.10938-1.4445c-65.717 0-76.826-151.97-142.54-151.97h-50v-0.0332c-63.913-0.57708-75.396-28.277-140.42-28.277z" style="fill:#f2f78a" sodipodi:nodetypes="cccccccccsccsc"/>
            <path data-index="33" class="flow" d="m468.21 145.52v1.2422c65.713 0 76.712 28.303 142.42 28.303l2e-3 6e-3h47.998v-2e-3c65.717 0 76.717 162.28 142.43 162.28l0.2827-0.58578-0.2827-0.65281c-65.717 0-76.717-162.28-142.43-162.28h-50v-0.0332c-63.913-0.57708-75.396-28.277-140.42-28.277z" style="fill:#f2f78a" sodipodi:nodetypes="cccccccccsccsc"/>
            <path data-index="34" class="flow" d="m468.22 146.76-0.01 0.35742c65.024 0 76.507 27.7 140.42 28.277v0.0332h50l5.0098 4e-3c6.38 3e-3 11.553 5.1727 11.553 11.553v182.16c0 6.38-5.1728 11.553-11.553 11.553h-644.28c-6.38 0-11.553-5.1728-11.553-11.553v-17.963c0-6.38 5.1727-11.551 11.553-11.551h5l10-0.17969-10-0.17968h-5c-6.5779 0-11.912 5.3323-11.912 11.91v17.963c0 6.5783 5.3338 11.912 11.912 11.912h644.28c6.5783 0 11.912-5.3338 11.912-11.912v-182.16c0-6.5783-5.3338-11.91-11.912-11.91l-5.0098-2e-3h-49.99v-0.0332c-63.913-0.57704-75.396-28.277-140.42-28.277z" style="fill:#f2f78a"/>
            <path data-index="35" class="flow" d="m468.21 147.12c65.713 0 74.709 45.28 140.42 45.28l1.3615 13.708-1.3615 12.17c-65.713 0-74.708-45.279-140.42-45.279z" style="fill:#a5d7d4" sodipodi:nodetypes="cccccc"/>
            <path data-index="36" class="flow" d="m467.21 173c65.713 0 76.703 189.56 142.42 189.56v1.163c-65.713 0-76.703-189.56-142.42-189.56z" style="fill:#a5d7d4" sodipodi:nodetypes="cccccc"/>
            <path data-index="37" class="flow" d="m658.63 192.4c161.43 0 161.43-99.143 322.85-99.143l10 5.3182-10 5.3182c-161.43 0-161.43 99.143-322.85 99.143z" style="fill:#a5d7d4"/>
            <path data-index="38" class="flow" d="m658.63 203.03c161.43 0 161.43-49.17 322.85-49.17l10 3.4055-10 3.4054c-161.43 0-161.43 49.17-322.85 49.17z" style="fill:#a5d7d4"/>
            <path data-index="39" class="flow" d="m658.63 209.84c161.43 0 161.43-13.938 322.85-13.938l10 1.2885-10 1.2885c-161.43 0-161.43 13.938-322.85 13.938z" style="fill:#a5d7d4"/>
            <path data-index="40" class="flow" d="m658.63 212.42c161.43 0 161.43 57.848 322.85 57.848l10 0.49337-10 0.49337c-161.43 0-161.43-57.848-322.85-57.848z" style="fill:#a5d7d4"/>
            <path data-index="41" class="flow" d="m658.63 213.41c161.43 0 161.43 152.61 322.85 152.61l10 0.70565-10 0.70564c-161.43 0-161.43-152.61-322.85-152.61z" style="fill:#a5d7d4"/>
            <path data-index="42" class="flow" d="m658.63 214.82 2e-3 1.2676c65.71 0 76.716 62.985 142.42 62.99v6e-3h49.998v-1.4785h-49.932v-6e-3c-65.714 0-76.777-62.779-142.49-62.779zm322.86 15.17c-65.717 0-65.717 46.125-131.43 46.125v1.4805c65.717 0 65.717-46.125 131.43-46.125l7.3516-0.17382 2.6484-0.56641-3.4238-0.73242z" style="fill:#dec580"/>
            <path data-index="43" class="flow" d="m658.63 216.09-0.01 0.9336c65.625 0 76.97 71.747 142.44 71.947v4e-3h50v-0.30078c4.2763-0.0362 8.2883-0.28522 12.039-0.7461-3.7508 0.46034-7.7632 0.70802-12.039 0.74415v-0.79102h-49.91c-65.708 0-76.807-71.791-142.52-71.791zm322.86 17.68c-65.717 0-65.717 53.1-131.43 53.1v0.92383c65.717 0 65.717-53.1 131.43-53.1l3.3906-0.46289z" style="fill:#f2f78a"/>
            <path data-index="44" class="flow" d="m24.359 339.63h-5a11.552 11.552 0 0 0-11.552 11.552v17.963a11.552 11.552 0 0 0 11.552 11.552h644.28a11.552 11.552 0 0 0 11.552-11.552v-140.57a11.552 11.552 0 0 0-11.552-11.552h-5v1.2557h5a10.296 10.296 0 0 1 10.296 10.296v140.57a10.296 10.296 0 0 1-10.296 10.296h-644.28a10.296 10.296 0 0 1-10.296-10.296v-17.963a10.296 10.296 0 0 1 10.296-10.296h5l10-0.62784z" style="fill:#a5d7d4"/>
            <path data-index="45" class="flow" d="m658.63 362.56c161.43 0 161.43-201.88 322.85-201.88l10 0.32607-10 0.32606c-161.43 0-161.43 201.88-322.85 201.88z" style="fill:#a5d7d4"/>
            <path data-index="46" class="flow" d="m658.63 363.21c161.43 0 161.43 4.2165 322.85 4.2165l10 0.10749-10 0.10749c-161.43 0-161.43-4.2165-322.85-4.2165z" style="fill:#a5d7d4"/>
            <path data-index="47" class="flow" d="m24.359 340.88h-5a10.296 10.296 0 0 0-10.296 10.296v27.541a10.296 10.296 0 0 0 10.296 10.296h644.28a10.296 10.296 0 0 0 10.296-10.296v-5a10.296 10.296 0 0 0-10.296-10.296h-5v0.29593h5a10 10 0 0 1 10 10v5a10 10 0 0 1-10 10h-644.28a10 10 0 0 1-10-10v-27.541a10 10 0 0 1 10-10h5l10-0.14796z" style="fill:#a5d7d4"/>
            <path data-index="48" class="flow" d="m850.06 322.97c65.713 0 65.713 5.4661 131.43 5.4661l10 1.5156-10 1.5156c-65.713 0-65.713-5.4661-131.43-5.4661z" style="fill:#e3a6aa"/>
            <path data-index="49" class="flow" d="m850.06 336.11c65.713 0 65.713-4.64 131.43-4.64l10 0.61929-10 0.6193c-65.713 0-65.713 4.64-131.43 4.64z" style="fill:#e3a6aa"/>

            <rect class="node" data-name="Secondary Aggregates" x="35.359" y="274.63" width="50" height="4.6548" style="fill:#a5d7d4"/>
            <text class="node-label" x="4.5913086" y="280.06335">Secondary Aggregates</text>

            <rect class="node" data-name="Marine Dredged Outside English Waters" x="35.359" y="308.19" width="50" height=".53699" style="fill:#c5e9df"/>
            <text class="node-label" x="52.88427" y="305.83542" style="line-height:0.9;word-spacing:0px"><tspan data-index="tspan34318" x="52.88427" y="305.83542" dx="0" style="text-align:center;text-anchor:middle" sodipodi:role="line">Marine Dredged</tspan><tspan data-index="tspan89992" x="52.88427" y="316.63541" style="text-align:center;text-anchor:middle" sodipodi:role="line">Outside English Waters</tspan></text>

            <rect class="node" data-name="Scalpings and Fines" x="35.359" y="334.97" width="50" height="6.2065" style="fill:#d980b7"/>
            <text class="node-label" x="6.2680664" y="341.17816">Scalpings and Fines</text>

            <rect class="node" data-name="Demolition" x="35.359" y="201.46" width="50" height="30.304" style="fill:#d980b7"/>
            <text class="node-label" x="38.908684" y="220.90132">Demolition</text>

            <rect class="node open-node" data-name="Extraction" x="35.359" y="22.221" width="50" height="132.99" style="fill:#a7e66f"/>
            <text class="node-label" x="39.456894" y="93.502838">Extraction</text>

            <rect class="node" data-name="Processing/Production" x="418.21" y="70.04" width="50" height="153.74" style="fill:#a7e66f"/>
            <text class="node-label" x="442.83981" y="143.6123"><tspan data-index="tspan41438" x="442.83981" y="143.6123" style="text-align:center;text-anchor:middle" sodipodi:role="line">Processing /</tspan><tspan data-index="tspan41440" x="442.83981" y="154.8623" style="text-align:center;text-anchor:middle" sodipodi:role="line">production</tspan></text>

            <rect class="node" data-name="Processing/Production Secondary Aggregates" x="609.63" y="362.56" width="50" height="1.163" style="fill:#a5d7d4"/>
            <text class="node-label" x="558.03546" y="356.08078">Secondary Aggregates</text>

            <path class="node" data-name="C&D Waste" d="m608.63 192.4h50v25.878h-50z" style="fill:#d980b7"/>
            <text class="node-label" x="610.43738" y="208.65866">C&D Waste</text>

            <rect class="node" data-name="Land Won" x="801.06" y="322.97" width="50" height="3.0313" style="fill:#c48d98"/>
            <text class="node-label" x="804.15411" y="326.94952">Land Won</text>

            <rect class="node" data-name="Marine Dredged" x="801.06" y="336.11" width="50" height="1.2386" style="fill:#c5e9df"/>
            <text class="node-label" x="796.67047" y="338.88782">Marine Dredged</text>

            <rect class="node" data-name="Concreting Manufacturing" x="992.47" y="65.6" width="50" height="38.292" style="fill:#ca91fd"/>
            <text class="node-label" x="1017.4601" y="82.573311" text-anchor="end" style="line-height:1"><tspan data-index="tspan46700" x="1017.4601" y="82.573311" style="text-align:center;text-anchor:middle" sodipodi:role="line">Concreting</tspan><tspan data-index="tspan46702" x="1017.4601" y="91.573311" style="text-align:center;text-anchor:middle" sodipodi:role="line">manufacturing</tspan></text>

            <rect class="node" data-name="Asphalt Manufacturing" x="992.47" y="267.01" width="50" height="4.2519" style="fill:#ca91fd"/>
            <text class="node-label" x="1017.4601" y="266.96326" text-anchor="end" style="line-height:1"><tspan data-index="tspan49350" x="1017.4601" y="266.96326" style="text-align:center;text-anchor:middle" sodipodi:role="line">Asphalt</tspan><tspan data-index="tspan49352" x="1017.4601" y="275.96326" style="text-align:center;text-anchor:middle" sodipodi:role="line">manufacturing</tspan></text>

            <rect class="node" data-name="Mortar Manufacturing" x="992.47" y="362.58" width="50" height="5.0641" style="fill:#f2f78a"/>
            <text class="node-label" x="1017.4601" y="363.22455" text-anchor="end" style="line-height:0.9"><tspan data-index="tspan52084" x="1017.4601" y="363.22455" style="text-align:center;text-anchor:middle" sodipodi:role="line">Mortar</tspan><tspan data-index="tspan52086" x="1017.4601" y="371.32455" style="text-align:center;text-anchor:middle" sodipodi:role="line">manufacturing</tspan></text>

            <rect class="node" data-name="Aggregate Use" x="992.47" y="135.12" width="50" height="26.206" style="fill:#ca91fd"/>
            <text class="node-label" x="1047.6792" y="150.38551" text-anchor="end">Aggregate Use</text>

            <rect class="node" data-name="Non-aggregate Use" x="992.47" y="188.57" width="50" height="9.9123" style="fill:#ca91fd"/>
            <text class="node-label" x="1056.5737" y="195.68867" text-anchor="end">Non-aggregate Use</text>

            <rect class="node" data-name="Use as Fill" x="992.47" y="224.94" width="50" height="10.654" style="fill:#ca91fd"/>
            <text class="node-label" x="1038.4265" y="233.48421" text-anchor="end">Use as Fill</text>

            <rect class="node" data-name="Trade" x="992.47" y="328.44" width="50" height="4.2699" style="fill:#a7e66f"/>
            <text class="node-label" x="1029.1562" y="333.79214" text-anchor="end">Trade</text>

            <rect class="node" data-name="Overburden and Interburden" x="992.47" y="8.2704" width="50" height="8.5046" style="fill:#d980b7"/>
            <text class="node-label" x="1018.6625" y="6.5214844" text-anchor="end" style="line-height:0.7"><tspan data-index="tspan44032" x="1018.6625" y="6.5214844" dy="0" style="text-align:center;text-anchor:middle" sodipodi:role="line">Overburden</tspan><tspan data-index="tspan44034" x="1018.6625" y="14.921484" style="text-align:center;text-anchor:middle" sodipodi:role="line">and</tspan><tspan data-index="tspan44038" x="1018.6625" y="23.321484" style="text-align:center;text-anchor:middle" sodipodi:role="line">Interburden</tspan></text>

            <text x="208.57057" y="157.92307">Sand</text>
            <text x="204.06354" y="131.05695">Gravel</text>
            <text x="190.16293" y="66.066597">Crushed Rock</text>
            <text x="593.87408" y="165.42035">Sand</text>
            <text x="588.99615" y="130.98013">Gravel</text>
            <text x="571.55591" y="85.839005">Crushed Rock</text>
            <text x="810.37714" y="291.02887">Sand</text>
            <text x="808.09631" y="280.8288">Gravel</text>
            <text x="796.75171" y="264.38617">Crushed Rock</text>
          </svg>
        </div>

        <div class="nodesankey" data-name="Manufacturing" hidden>Manufacturing</div>

        <div class="nodesankey" data-name="Use" hidden>
          <h4 class="text-center">Use</h4>
        </div>

        <div class="nodesankey subnodesankey" data-name="Infrastructure" hidden>
          <div class="back-sankey border-end border-bottom open-node" data-name="Use"><i class="fal fa-arrow-left"></i> Back to use</div>
          <h4 class="text-center mb-4">Infrastructure</h4>

          <svg data-name="Infrastructure" viewBox="0 0 1379.8 621.07" xmlns="http://www.w3.org/2000/svg">
            <path class="flow" id="0" d="m67.213 10.065c143.98 0 143.98-2.8871 287.96-2.8871l10 109.65-10 109.65c-143.98 0-143.98 2.8871-287.96 2.8871z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="1" d="m708.2 147.05c-149.68 0-149.68 112.55-299.37 112.55h-50c-142.71 0-152.71 2.7637-295.42 2.7637v50.277c142.71 0 152.71-2.7637 295.42-2.7637h50c149.68 0 149.68-112.55 299.37-112.55l10-25.141z" style="fill:#dec580;stroke-width:0px"/>
            <path class="flow" id="2" d="m708.2 197.32c-150.95 0-150.95 121.36-301.9 121.36h-50c-141.44 0-151.44-6.043-292.89-6.043v143.91c141.44 0 151.45 6.0449 292.89 6.0449h50c150.95 0 150.95-121.36 301.9-121.36l10-71.957z" style="fill:#f2f78a;stroke-width:0px"/>
            <path class="flow" id="3" d="m708.2 381.19c-152.85 0-152.85 115.26-305.7 115.26h-50c-140.18 0-150.18-8-290.35-8v93.619c140.18 0 150.18 8 290.35 8h50c152.85 0 152.85-115.26 305.7-115.26l10-46.809z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="4" d="m415.17 7.1779c310.35 0 310.35-7.1775 620.7-7.1775l10 6.876-10 6.876c-310.35 0-310.35 7.1775-620.7 7.1775z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="5" d="m415.17 20.93c449.47 0 449.47 374.79 898.94 374.79l10 0.68246-10 0.68246c-449.47 0-449.47-374.79-898.94-374.79z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="6" d="m768.2 147.05c133.84 0 133.84-133.29 267.68-133.29l10 80.68-10 80.68c-133.84 0-133.84 133.29-267.68 133.29z" style="fill:#e3a6aa;stroke-width:0px"/>
            <path class="flow" id="7" d="m768.2 308.41c135.11 0 135.11-8.1398 270.21-8.1398l10 11.649-10 11.649c-135.11 0-135.11 8.1398-270.21 8.1398z" style="fill:#e3a6aa;stroke-width:0px"/>
            <path class="flow" id="8" d="m768.2 331.7c272.96 0 272.96 65.379 545.92 65.379l10 14.743-10 14.743c-272.96 0-272.96-65.379-545.92-65.379z" style="fill:#e3a6aa;stroke-width:0px"/>
            <path class="flow" id="9" d="m768.2 381.19c133.84 0 133.84-206.08 267.68-206.08l10 31.795-10 31.795c-133.84 0-133.84 206.08-267.68 206.08z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="10" d="m768.2 444.78c272.96 0 272.96-18.211 545.92-18.211l10 39.583-10 39.583c-272.96 0-272.96 18.211-545.92 18.211z" style="fill:#ae9e80;stroke-width:0px"/>
            <path class="flow" id="11" d="m768.2 531.17c133.84 0 133.84-292.47 267.68-292.47l10 11.125-10 11.125c-133.84 0-133.84 292.47-267.68 292.47z" style="fill:#dec580;stroke-width:0px"/>
            <path class="flow" id="12" d="m768.2 553.42c272.96 0 272.96-47.686 545.92-47.686l10 12.7-10 12.7c-272.96 0-272.96 47.686-545.92 47.686z" style="fill:#dec580;stroke-width:0px"/>
            <path class="flow" id="13" d="m768.2 587.82c133.84 0 133.84-326.87 267.68-326.87l10 8.1568-10 8.1568c-133.84 0-133.84 326.87-267.68 326.87z" style="fill:#f2f78a;stroke-width:0px"/>
            <path class="flow" id="14" d="m768.2 604.13c272.96 0 272.96-73 545.92-73l10 8.4653-10 8.4653c-272.96 0-272.96 73-545.92 73z" style="fill:#f2f78a;stroke-width:0px"/>
            <path class="flow" id="15" d="m1095.9 4.3194e-4c107.22 0 107.22 0.15423 214.44 0.15423l10 138.63-10 138.63c-107.22 0-107.22-0.15423-214.44-0.15423z" style="fill:#e3a6aa;stroke-width:0px"/>
            <path class="flow" id="16" d="m1098.4 300.27c105.95 0 105.95-22.846 211.9-22.846l10 11.649-10 11.649c-105.95 0-105.95 22.846-211.9 22.846z" style="fill:#e3a6aa;stroke-width:0px"/>

            <rect class="node" x="13.41" y="262.36" width="50" height="194.19" style="fill:#ca91fd;stroke-width:0px"/>
            <text class="node-label" x="38.330482" y="356.1572" style="font-family:'Liberation Sans';font-size:9px"><tspan id="tspan14810" x="38.330482" y="356.1572" style="text-align:center;text-anchor:middle">Concreting</tspan><tspan id="tspan14812" x="38.330482" y="367.4072" style="text-align:center;text-anchor:middle">Manufacturing</tspan></text>

            <rect class="node-rect" x="12.143" y="488.45" width="50" height="93.619" style="fill:#ca91fd;stroke-width:0px"/>
            <text class="node-label" x="37.063484" y="531.95715" style="font-family:'Liberation Sans';font-size:9px"><tspan id="tspan16806" x="37.063484" y="531.95715" style="text-align:center;text-anchor:middle">Asphalt</tspan><tspan id="tspan16808" x="37.063484" y="543.20715" style="text-align:center;text-anchor:middle">Manufacturing</tspan></text>
            <text class="node-label" x="417.5473" y="392.21585" style="font-family:'Liberation Sans';font-size:9px">Sand</text>
            <text class="node-label" x="411.83258" y="288.93484" style="font-family:'Liberation Sans';font-size:9px">Gravel</text>
            <text class="node-label" x="406.01178" y="545.38965" style="font-family:'Liberation Sans';font-size:9px">Crushed Rock</text>
            <rect class="node-rect" x="17.213" y="10.065" width="50" height="219.29" style="fill:#a7e66f;stroke-width:0px"/>
            <text class="node-label" x="43.093689" y="117.3038" style="font-family:'Liberation Sans';font-size:9px"><tspan id="tspan4154" x="43.093689" y="117.3038" style="text-align:center;text-anchor:middle">Processing / </tspan><tspan id="tspan4156" x="43.093689" y="128.5538" style="text-align:center;text-anchor:middle">Production</tspan></text>
            <rect class="node-rect" x="718.2" y="587.82" width="50" height="33.244" style="fill:#f2f78a;stroke-width:0px"/>
            <text class="node-label" x="720.60193" y="607.65991" style="font-family:'Liberation Sans';font-size:9px">Road Sand</text>
            <rect class="node-rect" x="718.2" y="531.17" width="50" height="47.651" style="fill:#dec580;stroke-width:0px"/>
            <text class="node-label" x="717.86853" y="558.2121" style="font-family:'Liberation Sans';font-size:9px">Road Gravel</text>
            <rect class="node-rect" x="718.2" y="381.19" width="50" height="142.76" style="fill:#ae9e80;stroke-width:0px"/>
            <text class="node-label" x="702.3031" y="455.78363" style="font-family:'Liberation Sans';font-size:9px">Road Crushed Rock</text>
            <rect class="node-rect" x="365.17" y="7.178" width="50" height="219.29" style="fill:#ca91fd;stroke-width:0px"/>
            <text class="node-label" x="389.69012" y="113.61407" style="font-family:'Liberation Sans';font-size:9px"><tspan id="tspan10342" x="389.69012" y="113.61407" style="text-align:center;text-anchor:middle">Railway</tspan><tspan id="tspan10344" x="389.69012" y="128.61407" style="text-align:center;text-anchor:middle">Ballast</tspan></text>
            <rect class="node-rect" x="718.2" y="147.05" width="50" height="214.14" style="fill:#ca91fd;stroke-width:0px"/>
            <text class="node-label" x="704.17078" y="257.33423" style="font-family:'Liberation Sans';font-size:9px">Other Infrastructure</text>
            <rect class="node-rect" x="1045.9" y="5e-7" width="50" height="277.27" style="fill:#d980b7;stroke-width:0px"/>
            <text class="node-label" x="1049.5392" y="141.84966" style="font-family:'Liberation Sans';font-size:9px">Demolition</text>
            <rect class="node-rect" x="1048.4" y="300.27" width="50" height="23.297" style="fill:#d980b7;stroke-width:0px"/>
            <text class="node-label" x="1043.318" y="315.13135" style="font-family:'Liberation Sans';font-size:9px">Deconstruction</text>
            <rect class="node-rect" x="1320.3" y=".155" width="50" height="300.56" style="fill:#a7e66f;stroke-width:0px"/>
            <text class="node-label" x="1344.9753" y="146.97353" style="font-family:'Liberation Sans';font-size:9px"><tspan id="tspan23169" x="1344.9753" y="146.97353" style="text-align:center;text-anchor:middle">Waste</tspan><tspan id="tspan23171" x="1344.9753" y="158.22353" style="text-align:center;text-anchor:middle">Management</tspan></text>
            <rect class="node-rect" x="1324.1" y="395.72" width="50" height="152.35" style="fill:#a7e66f;stroke-width:0px"/>
            <text class="node-label" x="1360.1581" y="475.10855" text-anchor="end" style="font-family:'Liberation Sans';font-size:9px">Stock</text>
            <text x="215.95648" y="121.48527" style="font-family:'Liberation Sans';font-size:9px;line-height:1.25;text-align:center;text-anchor:middle">Crushed Rock</text>
          </svg>
        </div>
      <div class="nodesankey" data-name="Waste management" hidden>Waste management</div>
    </div>

    <div class="btn btn-light toggle-table my-4">
      <i class="fa fa-caret-down me-2"></i> <span class="label">Data table</span>
    </div>
    <div id="table-wrapper" class="d-none mb-4">
      <table class="table" data-name="global">
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <table class="table" data-name="Use" hidden>
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <table class="table" data-name="Buildings" hidden>
        <thead>
          <tr>
            <th>Resource</th>
            <th>From</th>
            <th>To</th>
            <th>Quantity</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js" integrity="sha384-ODmDIVzN+pFdexxHEHFBQH3/9/vQ9uori45z4JjnFsRydbmQbmL5t1tQ0culUzyK" crossorigin="anonymous"></script>
  <script src="data.js"></script>

  <script>
    // some variables to keep track of things
    let scope = "global";
    let minimized = false;
    let selectedNode = "global";
    let selectedMaterial = false;

    function getNodeVar(svgName) {
      if (svgName == "global") {
        return "global_flows"
      } else if (svgName == "Use") {
        return "use_flows"
      } else if (svgName == "Buildings") {
        return "buildings_flows"
      } else if (svgName == "Extraction") {
        return "extraction_flows"
      } else if (svgName == "Processing/Production") {
        return "processing_flows"
      }
    }

    function highlightNode(svgName, nodeName) {
      unhighlightNode(svgName)

      let svg = $("svg[data-name='" + svgName + "']");
      let node = svg.find(".node[data-name='" + nodeName + "']");

      node.addClass("active")
      svg.find(".flow").addClass("opaque");

      let dataVar = getNodeVar(svgName);

      $(window[dataVar]).each(function(i, flow) {
        if (flow.from == nodeName || flow.to == nodeName) {
          svg.find(".flow[data-index='" + i + "']").removeClass("opaque");
        }
      });
    }

    function unhighlightNode(svgName) {
      $("svg[data-name='" + svgName + "'] .flow").removeClass("opaque")
      $("svg[data-name='" + svgName + "'] .node").removeClass("active")
    }

    function openNodeSankey(nodeName, subNode) {
      minimized = true;

      $("#col-svg").addClass("col-6 minimized").removeClass("col-12");
      $("#nodesankey-wrapper .nodesankey").attr("hidden", "hidden")

      $(".sankey-wrapper, #nodesankey-wrapper .nodesankey[data-name='" + nodeName + "']").removeAttr("hidden")

      if (!subNode) {
        highlightNode("global", nodeName)
      } else {
        unhighlightNode(selectedNode)
      }

      openTable(nodeName);

      selectedNode = nodeName;

      scrollTo(".sankey-wrapper")
    }

    function closeNodeSankey() {
      $(".sankey-wrapper").attr("hidden", "hidden");
      $("#col-svg").toggleClass("col-6 col-12 minimized");

      openTable("global");

      scrollTo("#col-svg")

      unhighlightNode("global")
      unhighlightNode(selectedNode)
      selectedNode = false
      minimized = false
    }

    function openTable(node) {
      $("#table-wrapper table").attr("hidden", "hidden")
      $("#table-wrapper table[data-name='" + node + "']").removeAttr("hidden")
    }

    $(".node").hover(
      function() {
        let svgName = $(this).parent("svg").data("name");
        let nodeName = $(this).data("name");
        highlightNode(svgName, nodeName)
      }, function() {
        if (minimized) {
          unhighlightNode(selectedNode)
        } else {
          unhighlightNode("global")
        }
      }
    );

    $(".open-node").click(function() {
      let thisNode = $(this)

      let nodeName = thisNode.data("name");
      let subNode = false;

      if (thisNode.attr("data-subnode")) {
        subNode = true;
      }

      openNodeSankey(nodeName, subNode)
    })

    $(".close-sankey").click(function() {
      closeNodeSankey()
    })

    function highlightMaterial(material) {

    }

    $(".select-material").click(function() {
      $(".flow:not(.opaque)").addClass("opaque")
      $(".node").removeClass("active")

      $("#inputs-ouputs").attr("hidden", "hidden");
      $("#category").removeAttr("hidden");

      let category = $(this).data("material")
      highlightMaterial(category)
    })

    // generic function to smoothly scroll to a jquery object
    function scrollTo(object) {
      $("html, body").animate({
        scrollTop: $(object).offset().top - 200
      }, 300);
    }

    $(".toggle-table").click(function() {
      $("#table-wrapper").toggleClass("d-none");
      $(".toggle-table i").toggleClass("fa-caret-down fa-caret-up")
    })

    const flowPopup = $("#popup");

    // follow cursor around
    $(".flow").mouseenter(function() {
      $(this).addClass("hover")
      flowPopup.show();
      let flowIndex = $(this).data("index")
      updatePopup(flowIndex)
    });

    $(".flow").mousemove(function(e) {
      flowPopup.css({
        left: e.pageX,
        top:  e.pageY,
      });
    });

    $(".flow").mouseleave(function() {
      $(this).removeClass("hover")
      flowPopup.hide();
    });

    // update popup
    function updatePopup(flowIndex) {
      let dataVar = getNodeVar(selectedNode);
      let flowData = $(window[dataVar])[flowIndex]

      $("#popup-from").html(flowData.from)
      $("#popup-to").html(flowData.to)
      $("#popup-value").html(flowData.value)
      $("#popup-material").html(flowData.material)
    }
  </script>
</body>
</html>

